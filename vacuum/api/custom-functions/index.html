<!doctype html><html lang=en><head><script type=application/ld+json>{"@context":"https://schema.org","@type":"NewsArticle","headline":"vacuum: Custom Functions","image":["https:\/\/quobix.com\/"],"datePublished":"2022-07-03 08:20:04 -0400 -0400","author":{"@type":"Person","name":"Dave Shanley","url":"https://quobix.com/author"}}</script><meta charset=utf-8><link rel=apple-touch-icon sizes=180x180 href=https://quobix.com//apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://quobix.com/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://quobix.com/favicon-16x16.png><meta name=description content="quobix::vaccum, The worlds fastest OpenAPI linter. "><meta charset=utf-8><meta name=keywords content="OpenAPI,swagger,spectral,linting,linter,vacuum,dave shanley,shanley,code,golang,java,javascript,typescript,quobix,engineer"><link crossorigin=use-credentials rel=manifest href=https://quobix.com/site.webmanifest><meta name=author content="Dave Shanley"><meta name=viewport content="width=device-width,initial-scale=1"><title>vacuum OpenAPI Linter: Custom Functions</title><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-PC979K2")</script><link rel=preload href=https://quobix.com/assets/bundle.js as=script><script src=https://quobix.com/assets/bundle.js></script><style>:root{--global-font-size:17px;--toc-font-size:0.7rem;--breadcrumb-font-size:0.75rem;--childnav-font-size:0.75rem;--nav-font-size:0.95rem;--toc-font-header-size:0.85rem;--rule-item-header-fontsize:1.2rem;--rule-item-header-fontsize-mobile:1rem;--rule-item-details-fontsize:0.8rem;--rule-format-fontsize:0.8rem;--rule-type-fontsize:0.7rem;--rule-severity-fontsize:0.8rem;--rule-recommended-fontsize:0.7rem;--rule-function-fontsize:0.8rem;--rule-recommended-banner-fontsize:1rem;--rule-panel-label:0.7rem;--rule-id-fontsize:2rem;--rule-id-fontsize-mobile:1.3rem;--global-line-height:1.4em;--global-space:10px;--vacuum-navigation-width-v:199px;--vacuum-navigation-width:200px;--font-stack:Menlo, Monaco, Roboto Mono, Lucida Console, Liberation Mono,
            DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace,
            serif;--mono-font-stack:Menlo, Monaco, Roboto Mono, Lucida Console, Liberation Mono,
            DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace,
            serif;--background-color:#0d1117;--background-color-alpha:rgba(13, 17, 23, 0.80);--background-color-alpha-mobile:rgba(13, 17, 23, 0.99);--rule-item-background:rgba(26, 32, 44, 0.51);--rule-recommended-background:rgb(33, 41, 55);--rule-stats-background:#0a0a0a;--rule-item-border:rgba(35, 43, 58, 0.9);--navigation-hover:#b685ff33;--navigation-child-selected:rgba(182, 133, 255, 0.36);--navigation-child-hover:rgba(179, 131, 250, 0.09);--navigation-child-container:linear-gradient(180deg, rgba(0,0,0,1) 0%, rgba(182,133,255,0.2) 50%);--vacuum-online-results-background:linear-gradient(180deg, rgba(13, 17, 23,1) 0%, rgba(223, 222, 225, 0.12) 50%);--page-width:65em;--font-color:#e8e9ed;--invert-font-color:#222225;--secondary-color:#b685ff;--secondary-color-lowalpha:rgba(182, 133, 255, 0.73);--secondary-color-very-lowalpha:rgba(182, 133, 255, 0.23);--secondary-color-shadow:rgb(59, 41, 87);--secondary-color-shadow-mid:rgb(78, 54, 114);--tertiary-color:#a3abba;--terminal-border:rgba(76, 81, 91, 0.5);--terminal-header-background:linear-gradient(90deg, rgba(76, 81, 91, 0.5) 0%, rgba(76, 81, 91, 0.1) 80%);--primary-color:rgba(98, 196, 255, 1.0);--primary-color-lowalpha:rgba(98, 196, 255, 0.6);--error-color:#ff3c74;--error-font-color:#ff246b;--error-color-lowalpha:rgba(255, 60, 116, 0.4);--progress-bar-background:#0a0a0a;--progress-bar-fill:#62c4ff;--code-bg-color:none;--input-style:solid;--display-h1-decoration:none;--bold-text:#b685ff;--terminal-green:#00FF00FF;--terminal-yellow:#fddb00;--hrcolor:#3d3d3d;--code-border:#525252;--string-literal:#fd66e5;--warn-400:#ff6a00;--warn-400-lowalpha:rgba(255, 106, 0, 0.15);--warn-300:#ff9900;--warn-300-lowalpha:rgba(255, 153, 0, 0.05);--warn-200:#ffb700;--warn-200-lowalpha:rgba(255, 183, 0, 0.15);--warn-color:#ffd500;--warn-color-lowalpha:rgba(255, 213, 0, 0.15);--ok-400:#f7ff00;--ok-400-lowalpha:rgba(230, 255, 0, 0.15);--ok-300:#d0ff00;--ok-300-lowalpha:rgba(208, 255, 0, 0.15);--ok-200:#aaff00;--ok-200-lowalpha:rgba(170, 255, 0, 0.15);--ok-color:#1aff00;--ok-color-lowalpha:rgba(170, 255, 0, 0.15)}</style><link rel=stylesheet href=https://quobix.com/assets/syntax.css><link rel=stylesheet href=https://quobix.com/assets/app.css><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="vacuum OpenAPI Linter: Custom Functions"><meta property="og:description" content="Sometimes using the core functions are just not enough. Sometimes we need more power, we need the ability to hook in custom code and custom business logic.
Spectral does a great job with custom functions, So, vacuum has adopted a very similar design, to facilitate custom functions.
vacuum is written in go, so it can only run functions also written in go. Structure of a custom function A custom function is written the exact same way that all functions are written in vacuum."><meta property="og:publish_date" content="2022-07-03 08:20:04 -0400 -0400"><meta property="og:url" content="https://quobix.com/vacuum/api/custom-functions/"><meta property="og:site_name" content="quobix"><meta property="og:image" content="https://quobix.com/images/vacuum/logo-blackbg.png"><meta property="og:image:width" content="1400"><meta property="og:image:height" content="680"><meta property="og:image:secure_url" content="https://quobix.com/images/vacuum/logo-blackbg.png"><meta property="og:image:type" content="image/png"><meta property="og:image:alt" content="https://quobix.com/images/vacuum/logo-blackbg.png"><meta property="article:author" content="https://quobix.com"><meta property="article:publisher" content="https://quobix.com"><meta property="article:section" content="Software"><meta property="article:published_time" content="2022-07-03 08:20:04 -0400 -0400"><meta property="article:modified_time" content="2022-07-03 08:20:04 -0400 -0400"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@daveshanley"><meta name=twitter:creator content="@daveshanley"><meta name=twitter:label1 content="Written by"><meta name=twitter:data1 content="Dave Shanley"><link rel=stylesheet href=https://quobix.com/assets/vacuum.css></head><body class=terminal><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PC979K2" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class=quobix-header><section class=terminal-nav id=main-navigation><header class=terminal-logo><div class="logo terminal-prompt"><a href=https://quobix.com/>quobix</a><span class=vacuum-sep>::</span><span class=vacuum-title>vacuum</span></div></header><nav class=terminal-menu id=header-menu><ul itemscope itemtype=http://schema.org/BreadcrumbList><li itemprop=itemListElement itemscope itemtype=http://schema.org/ListItem><a href=https://quobix.com/articles/ itemprop=item class=menu-item><span itemprop=name>Articles</span><meta itemprop=position content="1"></a></li><li itemprop=itemListElement itemscope itemtype=http://schema.org/ListItem><a href=https://quobix.com/author/ itemprop=item class=menu-item><span itemprop=name>Author</span><meta itemprop=position content="2"></a></li><li itemprop=itemListElement itemscope itemtype=http://schema.org/ListItem><a href=https://quobix.com/vacuum/ itemprop=item class=menu-item><span itemprop=name>vacuum</span><meta itemprop=position content="3"></a></li></ul></nav></section><hr id=top-nav-divider></div><div class=container><div class=main-container><main class=content-container><nav class=vacuum-navigation><div class=fixed-position><a href=https://quobix.com/vacuum/start class=quick-start-navigation>Quick Start Guide&nbsp;</a><hr class=quick-start-divider><vacuum-desktop-navigation><vacuum-nav-item url=https://quobix.com/vacuum/installing/ name=Installing></vacuum-nav-item></vacuum-nav-item>
<vacuum-nav-item url=https://quobix.com/vacuum/about/ name="About vacuum"></vacuum-nav-item>
<vacuum-nav-item url=https://quobix.com/vacuum/why/ name=Why?></vacuum-nav-item>
<vacuum-nav-item url=https://quobix.com/vacuum/concepts/ name=Concepts></vacuum-nav-item>
<vacuum-nav-item url=https://quobix.com/vacuum/demo/ name="Online Demo ðŸª„"></vacuum-nav-item>
<vacuum-nav-item url name="CLI Commands"><ul class=navigation-children><li class=child-nav><a href=https://quobix.com/vacuum/commands/lint/>Lint</a></li><li class=child-nav><a href=https://quobix.com/vacuum/commands/report/>vacuum Report</a></li><li class=child-nav><a href=https://quobix.com/vacuum/commands/dashboard/>Dashboard</a></li><li class=child-nav><a href=https://quobix.com/vacuum/commands/html-report/>HTML Report</a></li><li class=child-nav><a href=https://quobix.com/vacuum/commands/spectral-report/>Spectral Report</a></li></ul></vacuum-nav-item><vacuum-nav-item url name="Developer API" open><ul class=navigation-children><li class=child-nav><a href=https://quobix.com/vacuum/api/getting-started/>API Quick Start</a></li><li class=child-nav><a href=https://quobix.com/vacuum/api/spec-index/>Spec Index</a></li><li class=child-nav><a href=https://quobix.com/vacuum/api/rule-resultset/>RuleResultSet</a></li><li class=child-nav><a href=https://quobix.com/vacuum/api/loading-ruleset/>Loading RuleSet</a></li><li class=active-child-nav>Custom Functions</li></ul></vacuum-nav-item><vacuum-nav-item url name=Functions><ul class=navigation-children><li class=child-nav><a href=https://quobix.com/vacuum/functions/core/>Core Functions</a></li><li class=child-nav><a href=https://quobix.com/vacuum/functions/openapi/>OpenAPI Functions</a></li></ul></vacuum-nav-item><vacuum-nav-item url name=Rules><ul class=navigation-children><li class=child-nav><a href=https://quobix.com/vacuum/rules/examples/>Examples</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/operations/>Operations/Paths</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/schemas/>Schemas</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/information/>Spec Information</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/validation/>Validation</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/descriptions/>Descriptions</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/tags/>Tags</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/security/>Security</a></li></ul></vacuum-nav-item><vacuum-nav-item url name=RuleSets><ul class=navigation-children><li class=child-nav><a href=https://quobix.com/vacuum/rulesets/understanding/>Understanding RuleSets</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rulesets/all/>All Rules</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rulesets/no-rules/>No Rules/Off</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rulesets/recommended/>Recommended Rules</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rulesets/custom-rulesets/>Custom RuleSets</a></li></ul></vacuum-nav-item></vacuum-desktop-navigation><hr class=nav-divider><a class=github-link href=https://github.com/daveshanley/vacuum>GitHub</a></div></nav><mobile-nav><ul class=mobile-nav><li class=mobile-nav><a href=https://quobix.com/vacuum/installing/>Installing</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/start/>Quick Start</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/about/>About vacuum</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/why/>Why?</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/concepts/>Concepts</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/demo/>Online Demo ðŸª„</a></li><li class=mobile-nav>CLI Commands<ul><li class=mobile-nav><a href=https://quobix.com/vacuum/commands/lint/>Lint</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/commands/report/>vacuum Report</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/commands/dashboard/>Dashboard</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/commands/html-report/>HTML Report</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/commands/spectral-report/>Spectral Report</a></li></ul></li><li class=mobile-nav>Developer API<ul><li class=mobile-nav><a href=https://quobix.com/vacuum/api/getting-started/>API Quick Start</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/api/spec-index/>Spec Index</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/api/rule-resultset/>RuleResultSet</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/api/loading-ruleset/>Loading RuleSet</a></li><li class="mobile-nav active-section"><a href=https://quobix.com/vacuum/api/custom-functions/>Custom Functions</a></li></ul></li><li class=mobile-nav>Functions<ul><li class=mobile-nav><a href=https://quobix.com/vacuum/functions/core/>Core Functions</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/functions/openapi/>OpenAPI Functions</a></li></ul></li><li class=mobile-nav>Rules<ul><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/examples/>Examples</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/operations/>Operations/Paths</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/schemas/>Schemas</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/information/>Spec Information</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/validation/>Validation</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/descriptions/>Descriptions</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/tags/>Tags</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/security/>Security</a></li></ul></li><li class=mobile-nav>RuleSets<ul><li class=mobile-nav><a href=https://quobix.com/vacuum/rulesets/understanding/>Understanding RuleSets</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rulesets/all/>All Rules</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rulesets/no-rules/>No Rules/Off</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rulesets/recommended/>Recommended Rules</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rulesets/custom-rulesets/>Custom RuleSets</a></li></ul></li></ul></mobile-nav><section class=vacuum-content><div class=breadcrumbs><ul itemscope itemtype=http://schema.org/BreadcrumbList><li itemprop=itemListElement itemscope itemtype=http://schema.org/ListItem><a itemprop=item typeof="WebPage" href=https://quobix.com/vacuum/><span itemprop=name>vacuum</span><meta itemprop=position content="3"></a></li><li itemprop=itemListElement itemscope itemtype=http://schema.org/ListItem><a itemprop=item typeof="WebPage" href=https://quobix.com/vacuum/api/><span itemprop=name>API</span><meta itemprop=position content="2"></a></li><li class=crumb-active itemprop=itemListElement itemscope itemtype=http://schema.org/ListItem><a itemprop=item typeof="WebPage" href=https://quobix.com/vacuum/api/custom-functions/><span itemprop=name>Custom Functions</span><meta itemprop=position content="1"></a></li></ul></div><article class=framed-content><h1 class=article-title>Custom Functions</h1><div class=article-strapline><em>Need more power? Want to write custom code?</em></div><section class=article-body><hr><p>Sometimes using the <a href=https://quobix.com/vacuum/functions/core/>core functions</a> are just not enough. Sometimes we need
more power, we need the ability to <strong>hook in</strong> custom code and custom business logic.</p><p>Spectral does a great job with <a href=https://meta.stoplight.io/docs/spectral/ZG9jOjI1MTkw-custom-functions>custom functions</a>,
So, vacuum has adopted a <strong><em>very similar</em></strong> design, to facilitate custom functions.</p><div class="terminal-alert terminal-alert-primary">vacuum is written in <a href=https://go.dev/>go</a>, so it can only run functions also written in <a href=https://go.dev/>go</a>.</div><hr><h2 id=structure-of-a-custom-function>Structure of a custom function</h2><p>A custom function is written the <strong>exact same way</strong> that <strong><em>all</em></strong> functions are written in vacuum.
The <a href=https://quobix.com/vacuum/functions/core>core functions</a> and the <a href=https://quobix.com/vacuum/functions/openapi/>OpenAPI functions</a>
as well as core functions all implement the <a href=https://pkg.go.dev/github.com/daveshanley/vacuum/model#RuleFunction>RuleFunction</a>
interface.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>RuleFunction</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>RunRule</span><span class=p>(</span><span class=nx>nodes</span> <span class=p>[]</span><span class=o>*</span><span class=nx>yaml</span><span class=p>.</span><span class=nx>Node</span><span class=p>,</span> <span class=nx>context</span> <span class=nx>RuleFunctionContext</span><span class=p>)</span> <span class=p>[]</span><span class=nx>RuleFunctionResult</span>
</span></span><span class=line><span class=cl>  <span class=nf>GetSchema</span><span class=p>()</span> <span class=nx>RuleFunctionSchema</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=the-runrule-method>The RunRule method</h3><p><code>RunRule</code> accepts a slice of <a href=https://pkg.go.dev/gopkg.in/yaml.v3#Node>Node</a> references, these are nodes that
match the <a href=https://quobix.com/vacuum/rulesets/understanding/>given</a> property of the <a href=https://quobix.com/vacuum/rulesets/understanding/>rule</a>.</p><blockquote><p>The &lsquo;given&rsquo; value is a JSON Path.</p></blockquote><p>The second argument to the <code>RunRule</code> method is a <a href=https://pkg.go.dev/github.com/daveshanley/vacuum/model#RuleFunctionContext>RuleFunctionContext</a>
struct. This contains just about everything you need to know about the specification, the rule that is using the function, the
function options being passed in from the rule, as well as an <a href=https://quobix.com/vacuum/api/spec-index>index</a> that contains every reference
to every part of the spec.</p><h3 id=the-getschema-method>The GetSchema method</h3><p><code>GetSchema</code> returns a instance of <a href=https://pkg.go.dev/github.com/daveshanley/vacuum/model#RuleFunctionSchema>RuleFunctionSchema</a> which
defines how the function should be used and the name it exposes to be &ldquo;mapped&rdquo; to a rule.</p><h2 id=building-custom-functions-as-plugins>Building custom functions as &lsquo;plugins&rsquo;</h2><p>vacuum is deployed as a compiled application, which means you can&rsquo;t modify the source. The only way to inject custom functions
into the code, is to have vacuum look for compiled functions defined as a <strong>plugin</strong>, These custom comiled functions can then be loaded
at runtime and used as part of any ruleset.</p><h2 id=example-plugin>Example Plugin</h2><p>Make sure you have <a href=https://go.dev/>go</a> and <a href=https://quobix.com/vacuum/installing/>vacuum</a> installed first.</p><h3 id=setting-things-up>Setting things up</h3><p>The create a new directory for your plugin, and change into it.</p><terminal-window><terminal-header>create plugin dir</terminal-header>
<terminal-command command="mkdir my-plugin && cd my-plugin" cliname=mkdir clicommand=my-plugin flags></terminal-command></terminal-window><p>Next, initialize your code as a module</p><terminal-window><terminal-header>init module</terminal-header>
<terminal-command command="go mod init my-awesome-functions" cliname=go clicommand=mod flags=init></terminal-command></terminal-window><p>Now, include vacuum as a dependency</p><terminal-window><terminal-header>include vacuum dependency</terminal-header>
<terminal-command command="go get github.com/daveshanley/vacuum" cliname=go clicommand=get flags></terminal-command></terminal-window><h3 id=implement-the-logic>Implement the logic</h3><p>Create a new struct (you can name it anything you like) and implement the <code>RunRule</code> and <code>GetSchema</code> methods
to qualify it as a function that can be run by vacuum.</p><terminal-window><terminal-header>write the function logic</terminal-header>
<terminal-command command="vi check_single_path.go" cliname=vi clicommand flags></terminal-command></terminal-window><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/daveshanley/vacuum/model&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;gopkg.in/yaml.v3&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// checkSinglePathExists is an example custom rule that checks only a
</span></span></span><span class=line><span class=cl><span class=c1>// single path exists.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>checkSinglePathExists</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>checkSinglePathExists</span><span class=p>)</span> <span class=nf>GetSchema</span><span class=p>()</span> <span class=nx>model</span><span class=p>.</span><span class=nx>RuleFunctionSchema</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>model</span><span class=p>.</span><span class=nx>RuleFunctionSchema</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;checkSinglePathExists&#34;</span><span class=p>,</span> <span class=c1>// Used to lookup the function
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>checkSinglePathExists</span><span class=p>)</span> <span class=nf>RunRule</span><span class=p>(</span><span class=nx>nodes</span> <span class=p>[]</span><span class=o>*</span><span class=nx>yaml</span><span class=p>.</span><span class=nx>Node</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>context</span> <span class=nx>model</span><span class=p>.</span><span class=nx>RuleFunctionContext</span><span class=p>)</span> <span class=p>[]</span><span class=nx>model</span><span class=p>.</span><span class=nx>RuleFunctionResult</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// get the index https://quobix.com/vacuum/api/spec-index/
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>index</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Index</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// get the paths node from the index.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>paths</span> <span class=o>:=</span> <span class=nx>index</span><span class=p>.</span><span class=nf>GetPathsNode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// checks if there are more than two nodes present in the paths node,
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// if so, more than one path is present.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>paths</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span> <span class=p>&gt;</span> <span class=mi>2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>msg</span> <span class=o>:=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;more than a single path exists, &#34;</span><span class=o>+</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;there are %v&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>paths</span><span class=p>.</span><span class=nx>Content</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=p>[]</span><span class=nx>model</span><span class=p>.</span><span class=nx>RuleFunctionResult</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>Message</span><span class=p>:</span>   <span class=nx>msg</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>StartNode</span><span class=p>:</span> <span class=nx>paths</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>EndNode</span><span class=p>:</span>   <span class=nx>paths</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>Path</span><span class=p>:</span>      <span class=s>&#34;$.paths&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>Rule</span><span class=p>:</span>      <span class=nx>context</span><span class=p>.</span><span class=nx>Rule</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=register-the-function>Register the function</h3><p>Once your function logic is complete, it&rsquo;s time to register the function as a plugin. This
is done by creating a <code>Boot</code> function that accepts a <a href=https://github.com/daveshanley/vacuum/blob/main/plugin/plugin_manager.go>Manager</a>
reference, that is used to register the functions as available to vacuum.</p><terminal-window><terminal-header>create function boot loader</terminal-header>
<terminal-command command="vi boot.go" cliname=vi clicommand flags></terminal-command></terminal-window><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/daveshanley/vacuum/plugin&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Boot is called by the Manager when the module is located.
</span></span></span><span class=line><span class=cl><span class=c1>// all custom functions should be registered here.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>Boot</span><span class=p>(</span><span class=nx>pm</span> <span class=o>*</span><span class=nx>plugin</span><span class=p>.</span><span class=nx>Manager</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>checkSinglePath</span> <span class=o>:=</span> <span class=nx>checkSinglePathExists</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// register custom functions with vacuum plugin manager.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>pm</span><span class=p>.</span><span class=nf>RegisterFunction</span><span class=p>(</span><span class=nx>checkSinglePath</span><span class=p>.</span><span class=nf>GetSchema</span><span class=p>().</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>checkSinglePath</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=compile-as-a-shared-object>Compile as a shared object.</h3><p>Go has a wonderful <a href=https://pkg.go.dev/plugin>plugin</a> feature. To use it, code has to be compiled as a
shared object using the <code>-buildmode=plugin</code> flag when compiling.</p><terminal-window><terminal-header>compile function and boot loader as plugin</terminal-header>
<terminal-command command="go build -buildmode=plugin boot.go check_single_path.go" cliname=go clicommand=build flags></terminal-command></terminal-window><p>There should now be a <code>boot.so</code> file in the &lsquo;my-plugin&rsquo; directory.</p><h2 id=configuring-functions>Configuring functions</h2><p>To use the newly compiled plugin, you will need to call it from a rule. Create a new <a href=https://quobix.com/vacuum/rulesets/understanding/>RuleSet</a>
or update an existing one, to include a new rule that calls the new custom function.</p><h3 id=example-ruleset>Example RuleSet</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extends</span><span class=p>:</span><span class=w> </span><span class=p>[[</span><span class=l>spectral:oas, off]]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>documentationUrl</span><span class=p>:</span><span class=w> </span><span class=l>https://quobix.com/vacuum/rulesets/custom-rulesets</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sample-paths-rule</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Load a custom function that checks for a single path</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=l>error</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>recommended</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>formats</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=l>oas2, oas3 ]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>given</span><span class=p>:</span><span class=w> </span><span class=l>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>then</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>function</span><span class=p>:</span><span class=w> </span><span class=l>checkSinglePathExists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>howToFix</span><span class=p>:</span><span class=w> </span><span class=l>use a spec with only a single path defined.</span><span class=w>
</span></span></span></code></pre></div><p>It&rsquo;s really important that the <code>function</code> property of the <code>then</code> object, matches the name exposed by the <code>GetSchema</code>
method on the custom function.</p><h2 id=run-vacuum-with--f>Run vacuum with &lsquo;-f&rsquo;</h2><p>To run custom functions, vacuum needs to know where to look for them. There is a global flag <code>-f</code> or <code>--function</code> that specifies
a path to where your custom function plugin is located.</p><terminal-window><terminal-header>run custom ruleset and functions</terminal-header>
<terminal-command command="vacuum lint -r my-ruleset.yaml -f ./my-plugin my-openapi-spec.yaml" cliname=vacuum clicommand=lint flags=-r,-f></terminal-command></terminal-window><p>There should be message informing that vacuum has located a function plugin, and how many functions were loaded.</p><div class="terminal-alert warning-box">If you see a message like: <em>Unable to open custom functions: plugin.Open("./my-plugin"): plugin was built with a different version of package&mldr;&rsquo;</em> then it&rsquo;s
because the version of go that you&rsquo;re using locally, is different to the one used to compile vacuum.</div><hr><h2 id=further-examples>Further Examples</h2><p>There is <a href=https://github.com/daveshanley/vacuum/tree/main/plugin/sample>an example function plugin</a> available that shows
a couple of custom functions being defined, That are then called by a <a href=https://github.com/daveshanley/vacuum/blob/main/rulesets/examples/sample-plugin-ruleset.yaml>custom ruleset</a>.</p></section></article></section><div class=right-nav><asisde class=table-of-contents><p>What's on this page</p><nav id=TableOfContents><ul><li><a href=#structure-of-a-custom-function>Structure of a custom function</a><ul><li><a href=#the-runrule-method>The RunRule method</a></li><li><a href=#the-getschema-method>The GetSchema method</a></li></ul></li><li><a href=#building-custom-functions-as-plugins>Building custom functions as &lsquo;plugins&rsquo;</a></li><li><a href=#example-plugin>Example Plugin</a><ul><li><a href=#setting-things-up>Setting things up</a></li><li><a href=#implement-the-logic>Implement the logic</a></li><li><a href=#register-the-function>Register the function</a></li><li><a href=#compile-as-a-shared-object>Compile as a shared object.</a></li></ul></li><li><a href=#configuring-functions>Configuring functions</a><ul><li><a href=#example-ruleset>Example RuleSet</a></li></ul></li><li><a href=#run-vacuum-with--f>Run vacuum with &lsquo;-f&rsquo;</a></li><li><a href=#further-examples>Further Examples</a></li></ul></nav></asisde></div></main></div><footer class=footer><a href=https://quobix.com/author>Dave Shanley</a> 2007-2022
<span class=generated-timestamp>[generated 11/21/22 12:35 UTC]</span></footer></div></body></html>