<!doctype html><html lang=en><head><script type=application/ld+json>{"@context":"https://schema.org","@type":"NewsArticle","headline":"vacuum: Custom JS Functions","image":["https:\/\/quobix.com\/"],"datePublished":"2023-07-22 08:20:04 -0400 -0400","author":{"@type":"Person","name":"Dave Shanley","url":"https://quobix.com/author"}}</script><meta charset=utf-8><link rel=apple-touch-icon sizes=180x180 href=https://quobix.com//apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://quobix.com/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://quobix.com/favicon-16x16.png><meta name=description content="quobix::vaccum, The worlds fastest OpenAPI linter. "><meta charset=utf-8><meta name=keywords content="OpenAPI,swagger,spectral,linting,linter,vacuum,dave shanley,shanley,code,golang,java,javascript,typescript,quobix,engineer"><link crossorigin=use-credentials rel=manifest href=https://quobix.com/site.webmanifest><meta name=author content="Dave Shanley"><meta name=viewport content="width=device-width,initial-scale=1"><title>vacuum OpenAPI Linter: Custom JS Functions</title><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-PC979K2")</script><link rel=preload href=https://quobix.com/assets/bundle.js as=script><script src=https://quobix.com/assets/bundle.js></script><style>:root{--global-font-size:17px;--toc-font-size:0.7rem;--breadcrumb-font-size:0.75rem;--childnav-font-size:0.75rem;--nav-font-size:0.95rem;--toc-font-header-size:0.85rem;--rule-item-header-fontsize:1.2rem;--rule-item-header-fontsize-mobile:1rem;--rule-item-details-fontsize:0.8rem;--rule-format-fontsize:0.8rem;--rule-type-fontsize:0.7rem;--rule-severity-fontsize:0.8rem;--rule-recommended-fontsize:0.7rem;--rule-function-fontsize:0.8rem;--rule-recommended-banner-fontsize:1rem;--rule-panel-label:0.7rem;--rule-id-fontsize:2rem;--rule-id-fontsize-mobile:1.3rem;--global-line-height:1.4em;--global-space:10px;--vacuum-navigation-width-v:199px;--vacuum-navigation-width:200px;--font-stack:Menlo, Monaco, Roboto Mono, Lucida Console, Liberation Mono,
            DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace,
            serif;--mono-font-stack:Menlo, Monaco, Roboto Mono, Lucida Console, Liberation Mono,
            DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace,
            serif;--background-color:#0d1117;--background-color-alpha:rgba(13, 17, 23, 0.80);--background-color-alpha-mobile:rgba(13, 17, 23, 0.99);--rule-item-background:rgba(26, 32, 44, 0.51);--rule-recommended-background:rgb(33, 41, 55);--rule-stats-background:#0a0a0a;--rule-item-border:rgba(35, 43, 58, 0.9);--navigation-hover:#b685ff33;--navigation-child-selected:rgba(182, 133, 255, 0.36);--navigation-child-hover:rgba(179, 131, 250, 0.09);--navigation-child-container:linear-gradient(180deg, rgba(0,0,0,1) 0%, rgba(182,133,255,0.2) 50%);--vacuum-online-results-background:linear-gradient(180deg, rgba(13, 17, 23,1) 0%, rgba(223, 222, 225, 0.12) 50%);--page-width:65em;--font-color:#e8e9ed;--invert-font-color:#222225;--secondary-color:#f83aff;--secondary-color-lowalpha:rgba(248, 58, 255, 0.30);--secondary-color-very-lowalpha:rgba(182, 133, 255, 0.23);--secondary-color-shadow:rgb(59, 41, 87);--secondary-color-shadow-mid:rgb(78, 54, 114);--tertiary-color:#a3abba;--terminal-border:rgba(76, 81, 91, 0.5);--terminal-header-background:linear-gradient(90deg, rgba(76, 81, 91, 0.5) 0%, rgba(76, 81, 91, 0.1) 80%);--primary-color:rgba(98, 196, 255, 1.0);--primary-color-lowalpha:rgba(98, 196, 255, 0.6);--error-color:#ff3c74;--error-font-color:#ff246b;--error-color-lowalpha:rgba(255, 60, 116, 0.4);--progress-bar-background:#0a0a0a;--progress-bar-fill:#62c4ff;--code-bg-color:none;--input-style:solid;--display-h1-decoration:none;--bold-text:#f83aff;--terminal-green:#00FF00FF;--terminal-yellow:#fddb00;--hrcolor:#3d3d3d;--code-border:#525252;--string-literal:#fd66e5;--warn-400:#ff6a00;--warn-400-lowalpha:rgba(255, 106, 0, 0.15);--warn-300:#ff9900;--warn-300-lowalpha:rgba(255, 153, 0, 0.05);--warn-200:#ffb700;--warn-200-lowalpha:rgba(255, 183, 0, 0.15);--warn-color:#ffd500;--warn-color-lowalpha:rgba(255, 213, 0, 0.15);--ok-400:#f7ff00;--ok-400-lowalpha:rgba(230, 255, 0, 0.15);--ok-300:#d0ff00;--ok-300-lowalpha:rgba(208, 255, 0, 0.15);--ok-200:#aaff00;--ok-200-lowalpha:rgba(170, 255, 0, 0.15);--ok-color:#1aff00;--ok-color-lowalpha:rgba(170, 255, 0, 0.15)}</style><link rel=stylesheet href=https://quobix.com/assets/syntax.css><link rel=stylesheet href=https://quobix.com/assets/app.css><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="vacuum OpenAPI Linter: Custom JS Functions"><meta property="og:description" content="Sometimes using the core functions are just not enough. Sometimes we need more power, we need the ability to hook in custom code and custom business logic.
Spectral does a great job with custom functions, So, vacuum has adopted a very similar design, to facilitate custom functions.
Since v0.3.0 vacuum support JavaScript based functions as well as golang based functions. vacuum is written in golang. When building a JavaScript function, we need to remember that the JavaScript code is being read in by vacuum and then parsed and executed by the goja JavaScript engine."><meta property="og:publish_date" content="2023-07-22 08:20:04 -0400 -0400"><meta property="og:url" content="https://quobix.com/vacuum/api/custom-javascript-functions/"><meta property="og:site_name" content="quobix"><meta property="og:image" content="https://quobix.com/images/vacuum/logo-blackbg.png"><meta property="og:image:width" content="1400"><meta property="og:image:height" content="680"><meta property="og:image:secure_url" content="https://quobix.com/images/vacuum/logo-blackbg.png"><meta property="og:image:type" content="image/png"><meta property="og:image:alt" content="https://quobix.com/images/vacuum/logo-blackbg.png"><meta property="article:author" content="https://quobix.com"><meta property="article:publisher" content="https://quobix.com"><meta property="article:section" content="Software"><meta property="article:published_time" content="2023-07-22 08:20:04 -0400 -0400"><meta property="article:modified_time" content="2023-07-22 08:20:04 -0400 -0400"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@daveshanley"><meta name=twitter:creator content="@daveshanley"><meta name=twitter:label1 content="Written by"><meta name=twitter:data1 content="Dave Shanley"><link rel=stylesheet href=https://quobix.com/assets/vacuum.css></head><body class=terminal><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PC979K2" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class=quobix-header><section class=terminal-nav id=main-navigation><header class=terminal-logo><div class="logo terminal-prompt"><a href=https://quobix.com/>quobix</a><span class=vacuum-sep>::</span><span class=vacuum-title>vacuum</span></div></header><nav class=terminal-menu id=header-menu><ul itemscope itemtype=http://schema.org/BreadcrumbList><li itemprop=itemListElement itemscope itemtype=http://schema.org/ListItem><a href=https://quobix.com/articles/ itemprop=item class=menu-item><span itemprop=name>Articles</span><meta itemprop=position content="1"></a></li><li itemprop=itemListElement itemscope itemtype=http://schema.org/ListItem><a href=https://quobix.com/author/ itemprop=item class=menu-item><span itemprop=name>Author</span><meta itemprop=position content="2"></a></li><li itemprop=itemListElement itemscope itemtype=http://schema.org/ListItem><a href=https://quobix.com/vacuum/ itemprop=item class="menu-item active"><span itemprop=name class=active>vacuum</span><meta itemprop=position content="3"></a></li></ul></nav></section><hr id=top-nav-divider></div><div class=container><div class=main-container><main class=content-container><nav class=vacuum-navigation><div class=fixed-position><a href=https://quobix.com/vacuum/start class=quick-start-navigation>Quick Start Guide&nbsp;</a><hr class=quick-start-divider><vacuum-desktop-navigation><vacuum-nav-item url=https://quobix.com/vacuum/installing/ name=Installing></vacuum-nav-item></vacuum-nav-item>
<vacuum-nav-item url=https://quobix.com/vacuum/about/ name="About vacuum"></vacuum-nav-item>
<vacuum-nav-item url=https://quobix.com/vacuum/why/ name=Why?></vacuum-nav-item>
<vacuum-nav-item url=https://quobix.com/vacuum/concepts/ name=Concepts></vacuum-nav-item>
<vacuum-nav-item url=https://quobix.com/vacuum/demo/ name="Online Demo ðŸª„"></vacuum-nav-item>
<vacuum-nav-item url=https://quobix.com/vacuum/faq/ name=FAQ></vacuum-nav-item>
<vacuum-nav-item url name="CLI Commands"><ul class=navigation-children><li class=child-nav><a href=https://quobix.com/vacuum/commands/lint/>Lint</a></li><li class=child-nav><a href=https://quobix.com/vacuum/commands/report/>vacuum Report</a></li><li class=child-nav><a href=https://quobix.com/vacuum/commands/dashboard/>Dashboard</a></li><li class=child-nav><a href=https://quobix.com/vacuum/commands/html-report/>HTML Report</a></li><li class=child-nav><a href=https://quobix.com/vacuum/commands/spectral-report/>Spectral Report</a></li><li class=child-nav><a href=https://quobix.com/vacuum/commands/external-references/>External References</a></li></ul></vacuum-nav-item><vacuum-nav-item url name="Developer API" open><ul class=navigation-children><li class=child-nav><a href=https://quobix.com/vacuum/api/getting-started/>API Quick Start</a></li><li class=child-nav><a href=https://quobix.com/vacuum/api/spec-index/>Spec Index</a></li><li class=child-nav><a href=https://quobix.com/vacuum/api/rule-resultset/>RuleResultSet</a></li><li class=child-nav><a href=https://quobix.com/vacuum/api/loading-ruleset/>Loading RuleSet</a></li><li class=child-nav><a href=https://quobix.com/vacuum/api/custom-functions/>Custom Go Functions</a></li><li class=active-child-nav>Custom JS Functions</li><li class=child-nav><a href=https://quobix.com/vacuum/api/non-openapi/>Non-OpenAPI Files</a></li></ul></vacuum-nav-item><vacuum-nav-item url name=Functions><ul class=navigation-children><li class=child-nav><a href=https://quobix.com/vacuum/functions/core/>Core Functions</a></li><li class=child-nav><a href=https://quobix.com/vacuum/functions/openapi/>OpenAPI Functions</a></li><li class=child-nav><a href=https://quobix.com/vacuum/functions/owasp/>OWASP Functions</a></li></ul></vacuum-nav-item><vacuum-nav-item url name=Rules><ul class=navigation-children><li class=child-nav><a href=https://quobix.com/vacuum/rules/examples/>Examples</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/owasp/>OWASP</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/operations/>Operations/Paths</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/schemas/>Schemas</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/information/>Spec Information</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/validation/>Validation</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/descriptions/>Descriptions</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/tags/>Tags</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rules/security/>Security</a></li></ul></vacuum-nav-item><vacuum-nav-item url name=RuleSets><ul class=navigation-children><li class=child-nav><a href=https://quobix.com/vacuum/rulesets/understanding/>Understanding RuleSets</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rulesets/all/>All Rules</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rulesets/no-rules/>No Rules/Off</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rulesets/recommended/>Recommended Rules</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rulesets/custom-rulesets/>Custom RuleSets</a></li><li class=child-nav><a href=https://quobix.com/vacuum/rulesets/owasp/>OWASP Rules</a></li></ul></vacuum-nav-item></vacuum-desktop-navigation><hr class=nav-divider><a class=github-link href=https://github.com/daveshanley/vacuum>GitHub</a>
<img class=nav-badge alt="GitHub Repo stars" src="https://img.shields.io/github/stars/daveshanley/vacuum?color=%23b685ff&style=flat-square"><br><a class=discord-link href=https://discord.gg/UAcUF78MQN>Discord</a>
<img class=nav-badge-discord alt=Discord src="https://img.shields.io/discord/923258363540815912?color=%23b685ff&style=flat-square"></div></nav><mobile-nav><ul class=mobile-nav><li class=mobile-nav><a href=https://quobix.com/vacuum/installing/>Installing</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/start/>Quick Start</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/about/>About vacuum</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/why/>Why?</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/concepts/>Concepts</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/demo/>Online Demo ðŸª„</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/faq/>FAQ</a></li><li class=mobile-nav>CLI Commands<ul><li class=mobile-nav><a href=https://quobix.com/vacuum/commands/lint/>Lint</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/commands/report/>vacuum Report</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/commands/dashboard/>Dashboard</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/commands/html-report/>HTML Report</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/commands/spectral-report/>Spectral Report</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/commands/external-references/>External References</a></li></ul></li><li class=mobile-nav>Developer API<ul><li class=mobile-nav><a href=https://quobix.com/vacuum/api/getting-started/>API Quick Start</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/api/spec-index/>Spec Index</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/api/rule-resultset/>RuleResultSet</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/api/loading-ruleset/>Loading RuleSet</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/api/custom-functions/>Custom Go Functions</a></li><li class="mobile-nav active-section"><a href=https://quobix.com/vacuum/api/custom-javascript-functions/>Custom JS Functions</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/api/non-openapi/>Non-OpenAPI Files</a></li></ul></li><li class=mobile-nav>Functions<ul><li class=mobile-nav><a href=https://quobix.com/vacuum/functions/core/>Core Functions</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/functions/openapi/>OpenAPI Functions</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/functions/owasp/>OWASP Functions</a></li></ul></li><li class=mobile-nav>Rules<ul><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/examples/>Examples</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/owasp/>OWASP</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/operations/>Operations/Paths</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/schemas/>Schemas</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/information/>Spec Information</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/validation/>Validation</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/descriptions/>Descriptions</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/tags/>Tags</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rules/security/>Security</a></li></ul></li><li class=mobile-nav>RuleSets<ul><li class=mobile-nav><a href=https://quobix.com/vacuum/rulesets/understanding/>Understanding RuleSets</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rulesets/all/>All Rules</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rulesets/no-rules/>No Rules/Off</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rulesets/recommended/>Recommended Rules</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rulesets/custom-rulesets/>Custom RuleSets</a></li><li class=mobile-nav><a href=https://quobix.com/vacuum/rulesets/owasp/>OWASP Rules</a></li></ul></li><hr class=mobile-nav-divider><li class=mobile-nav><a href=https://github.com/daveshanley/vacuum>GitHub</a>
<img class=nav-badge alt="GitHub Repo stars" src="https://img.shields.io/github/stars/daveshanley/vacuum?color=%23b685ff&style=flat-square"></li><li class=mobile-nav><a href=https://discord.gg/UAcUF78MQN>Discord</a>
<img class=nav-badge-discord alt="Discord Server" src="https://img.shields.io/discord/923258363540815912?color=%23b685ff&style=flat-square"></li></ul></mobile-nav><section class=vacuum-content><div class=breadcrumbs><ul itemscope itemtype=http://schema.org/BreadcrumbList><li itemprop=itemListElement itemscope itemtype=http://schema.org/ListItem><a itemprop=item typeof="WebPage" href=https://quobix.com/vacuum/><span itemprop=name>vacuum</span><meta itemprop=position content="3"></a></li><li itemprop=itemListElement itemscope itemtype=http://schema.org/ListItem><a itemprop=item typeof="WebPage" href=https://quobix.com/vacuum/api/><span itemprop=name>API</span><meta itemprop=position content="2"></a></li><li class=crumb-active itemprop=itemListElement itemscope itemtype=http://schema.org/ListItem><a itemprop=item typeof="WebPage" href=https://quobix.com/vacuum/api/custom-javascript-functions/><span itemprop=name>Custom JS Functions</span><meta itemprop=position content="1"></a></li></ul></div><article class=framed-content><h1 class=article-title>Custom JS Functions</h1><div class=article-strapline><em>Need more power? Write custom JavaScript code!</em></div><section class=article-body><hr><p>Sometimes using the <a href=https://quobix.com/vacuum/functions/core/>core functions</a> are just not enough. Sometimes we need
more power, we need the ability to <strong>hook in</strong> custom code and custom business logic.</p><p>Spectral does a great job with <a href=https://meta.stoplight.io/docs/spectral/ZG9jOjI1MTkw-custom-functions>custom functions</a>,
So, vacuum has adopted a <strong><em>very similar</em></strong> design, to facilitate custom functions.</p><div class="terminal-alert terminal-alert-primary">Since <code>v0.3.0</code> vacuum support JavaScript based functions as well as <a href=https://quobix.com/vacuum/api/custom-functions/>golang</a> based functions.</div><hr><div class="terminal-alert warning-box"><p>vacuum is written in golang. When building a JavaScript function, we need to remember that the JavaScript code is being
read in by vacuum and then parsed and executed by the <a href=https://github.com/dop251/goja>goja</a> JavaScript engine.</p><p>There is <strong>no <a href=https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction>DOM</a></strong>
available and there is limited access to <a href=https://nodejs.org/en>node.js</a> APIs. This is not a v8 environment, and vacuum only supports <a href=https://262.ecma-international.org/5.1/>ES5</a>.</p></div><hr><h2 id=structure-of-a-javascript-function>Structure of a JavaScript function</h2><p>vacuum expects an absolute minimum of one thing from a JavaScript function, a declaration of a function called <code>runRule</code>
that accepts a single argument. It looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>runRule</span><span class=p>(</span><span class=nx>input</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=c1>// do something useful with custom logic, this is just a silly example 
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=k>if</span> <span class=p>(</span><span class=nx>input</span> <span class=o>!==</span> <span class=s1>&#39;some-value&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>     <span class=p>{</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;something went wrong, input does not match &#34;some-value&#34;&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=p>];</span>
</span></span><span class=line><span class=cl> <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In the above example, the <code>runRule</code> function accepts a single argument called <code>input</code>. This is the value of the <code>given</code> property
that was located by the rule.</p><p>If the input does not match <code>some-value</code> then the function returns an array of objects, each object is a <code>modelRuleFunctionResult</code> that
contains a <code>message</code> property. This is the message that will be displayed in the linting report.</p><h3 id=the-input-argument>The input argument</h3><p>The input can be either a <code>primitive</code> value, or a <code>complex</code> value (<em>like an object or an array</em>). It all depends on how the rule
is configured to use the function, and what the <code>given</code> property is set to.</p><p>If the function only works on a single value, then the <code>given</code> property should be set to a JSON Path that points to a single value.
If the function needs to work on an array of values, then the <code>given</code> property should be set to a JSON Path that points to an array, etc.</p><hr><h2 id=access-to-context>Access to context</h2><p>If the function needs to know what rule is calling it, or what the specification looks like, then the <code>runRule</code> function can
access the <code>context</code> object. This is essentially a JSON rendered version of <a href=https://github.com/daveshanley/vacuum/blob/main/model/rules.go#L39>model.RuleFunctionContext</a>.</p><p>There are two objects that are not available to JavaScript functions, the <code>index</code> and the <code>document</code>.
The <code>index</code> is not available, because it&rsquo;s a complex struct with a lot of data in it and a large API. Without a full
replacement SDK, we can&rsquo;t make this available to JavaScript functions.</p><p>The <code>document</code> is not available, because of the same reason as the <code>index</code>.</p><h3 id=example-function-that-uses-context>Example function that uses context</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>runRule</span><span class=p>(</span><span class=nx>input</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=c1>// use context to determine the rule name and the given path
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=k>if</span> <span class=p>(</span><span class=nx>input</span> <span class=o>!==</span> <span class=s1>&#39;some-value&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>     <span class=p>{</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;rule&#39;</span> <span class=o>+</span> <span class=nx>context</span><span class=p>.</span><span class=nx>rule</span><span class=p>.</span><span class=nx>id</span> <span class=o>+</span> <span class=s1>&#39; failed at &#39;</span> <span class=o>+</span> <span class=nx>context</span><span class=p>.</span><span class=nx>given</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=p>];</span>
</span></span><span class=line><span class=cl> <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class="terminal-alert terminal-alert-primary">The <code>context</code> object is automatically available to the function as a global. It does not need to be declared as an argument to the <code>runRule</code> function.</div><h3 id=context-type>Context type</h3><p>TypeScript is not (yet) supported, but here is the type definition for the <code>context</code> and related objects would be.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>Context</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>ruleAction</span>: <span class=kt>RuleAction</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>rule</span>: <span class=kt>Rule</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>given</span>: <span class=kt>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>options</span>: <span class=kt>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>specInfo</span>: <span class=kt>SpecInfo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=specinfo-type>SpecInfo type</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>SpecInfo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>fileType</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>format</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>type</span><span class=o>:</span> <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>version</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=ruleaction-type>RuleAction type</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>RuleAction</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>field</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>functionOptions</span>: <span class=kt>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=rule-type>Rule type</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>Rule</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>id</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>description</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>given</span>: <span class=kt>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>formats</span>: <span class=kt>string</span><span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=nx>resolved</span>: <span class=kt>boolean</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>recommended</span>: <span class=kt>boolean</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>type</span><span class=o>:</span> <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>severity</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>then</span>: <span class=kt>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>ruleCategory</span>: <span class=kt>RuleCategory</span>
</span></span><span class=line><span class=cl>  <span class=nx>howToFix</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=rulecategory-type>RuleCategory type</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>RuleCategory</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>id</span>:          <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span>:        <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>description</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h2 id=access-to-the-function-options>Access to the function options</h2><p>All functions can accept options from the rule that is calling them. Options are available from <code>functionOptions</code> value. To access it,
start with the <code>context</code> object, and its under the <code>ruleAction</code> property.</p><h3 id=example-rule-and-function>Example rule and function</h3><p>Let&rsquo;s configure a ruleset that defines a custom function and passes in some function options.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>my-custom-js-rule</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;adding function options to use in JS functions.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>given</span><span class=p>:</span><span class=w> </span><span class=l>$</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=l>error</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>then</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>function</span><span class=p>:</span><span class=w> </span><span class=l>useFunctionOptions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>field</span><span class=p>:</span><span class=w> </span><span class=l>someField</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>functionOptions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>someOption</span><span class=p>:</span><span class=w> </span><span class=l>someValue</span><span class=w>
</span></span></span></code></pre></div><p>Now we can create a new file called <code>useFunctionOptions.js</code> and write the function logic.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>runRule</span><span class=p>(</span><span class=nx>input</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// extract function options from context
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>functionOptions</span> <span class=o>=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>ruleAction</span><span class=p>.</span><span class=nx>functionOptions</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// check if the &#39;someOption&#39; value is set in our options
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>functionOptions</span><span class=p>.</span><span class=nx>someOption</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>message</span><span class=o>:</span> <span class=s2>&#34;someOption is set to &#34;</span> <span class=o>+</span> <span class=nx>functionOptions</span><span class=p>.</span><span class=nx>someOption</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>message</span><span class=o>:</span> <span class=s2>&#34;someOption is not set&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The message will result in: <code>someOption is set to someValue</code></p><blockquote><p>The <code>given</code> value in a ruleset is a JSON Path.</p></blockquote><h2 id=providing-a-schema>Providing a schema</h2><p>Like with <a href=https://quobix.com/vacuum/api/custom-functions/>go plugins</a> providing a <code>getSchema()</code> function that returns an object that reflects an instance of <a href=https://pkg.go.dev/github.com/daveshanley/vacuum/model#RuleFunctionSchema>RuleFunctionSchema</a> which
defines how the function should be used and the name it exposes to be &ldquo;mapped&rdquo; to a rule.</p><p>For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getSchema</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;name&#34;</span><span class=o>:</span> <span class=s2>&#34;a_new_name_for_this&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;properties&#34;</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;name&#34;</span><span class=o>:</span> <span class=s2>&#34;mickey&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;description&#34;</span><span class=o>:</span> <span class=s2>&#34;a mouse&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h2 id=calling-core-functions>Calling core functions</h2><p>Any custom JavaScript function can call any of the <a href=https://quobix.com/vacuum/functions/core/>core functions</a>.</p><p>This is done by adding a prefix <code>vacuum_</code> to the function name. For example, to call the <a href=https://quobix.com/vacuum/functions/core/truthy>truthy</a> function, the function name
would be <code>vacuum_truthy</code>. Another function like <a href=https://quobix.com/vacuum/functions/core/schema>schema</a> would be <code>vacuum_schema</code>.</p><p>Each core function accepts <strong>two</strong> arguments, the first is the <code>input</code> value, and the second is the <code>context</code> object.</p><p>For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>runRule</span><span class=p>(</span><span class=nx>input</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// create an array to hold the results
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>results</span> <span class=o>=</span> <span class=nx>vacuum_truthy</span><span class=p>(</span><span class=nx>input</span><span class=p>,</span> <span class=nx>context</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>results</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=s2>&#34;this is a message, added after truthy was called&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// return results.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h2 id=tutorial>Tutorial</h2><p>Make sure you have <a href=https://quobix.com/vacuum/installing/>vacuum</a> installed first.</p><h3 id=setting-things-up>Setting things up</h3><p>The create a new directory for your functions, and change into it.</p><terminal-window><terminal-header>create function dir</terminal-header>
<terminal-command command="mkdir my-functions && cd my-functions" cliname=mkdir clicommand=my-functions flags></terminal-command></terminal-window><p>Next, build a custom JavaScript function that will be used by vacuum. This is a simple function that checks if there is more than one path
in an OpenAPI document.</p><h3 id=implement-the-logic>Implement the logic</h3><p>Create a new javascript file called <code>checkSinglePath.js</code> and write the function logic.</p><terminal-window><terminal-header>write the function logic</terminal-header>
<terminal-command command="vi checkSinglePath.js" cliname=vi clicommand flags></terminal-command></terminal-window><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>runRule</span><span class=p>(</span><span class=nx>input</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// get the number of keys passed in (each path is a key)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>numPaths</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=nx>input</span><span class=p>).</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>numPaths</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;More than a single path exists, there are &#39;</span> <span class=o>+</span> <span class=nx>numPaths</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>That&rsquo;s it! We&rsquo;re ready to call the function from a rule.</p><h3 id=configuring-functions>Configuring functions</h3><p>To use the function will need to call it from a rule. Create a new <a href=https://quobix.com/vacuum/rulesets/understanding/>RuleSet</a>
or update an existing one, to include a new rule that calls the new custom function.</p><h3 id=example-ruleset>Example RuleSet</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extends</span><span class=p>:</span><span class=w> </span><span class=p>[[</span><span class=l>spectral:oas, off]]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>documentationUrl</span><span class=p>:</span><span class=w> </span><span class=l>https://quobix.com/vacuum/rulesets/custom-rulesets</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sample-paths-rule</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Load a custom function that checks for a single path</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>severity</span><span class=p>:</span><span class=w> </span><span class=l>error</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>recommended</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>formats</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=l>oas2, oas3 ]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>given</span><span class=p>:</span><span class=w> </span><span class=l>$.paths</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>then</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>function</span><span class=p>:</span><span class=w> </span><span class=l>checkSinglePath</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>howToFix</span><span class=p>:</span><span class=w> </span><span class=l>use a spec with only a single path defined.</span><span class=w>
</span></span></span></code></pre></div><p>It&rsquo;s really important that the <code>function</code> property of the <code>then</code> object, matches the name exposed by the <code>getSchema()</code>
method on the custom function, or matches the <code>filename</code> of the javascript file.</p><h3 id=run-vacuum-with--f>Run vacuum with &lsquo;-f&rsquo;</h3><p>To run custom functions, vacuum needs to know where to look for them. There is a global flag <code>-f</code> or <code>--function</code> that specifies
a path to where your custom function plugin is located.</p><terminal-window><terminal-header>run custom ruleset and functions</terminal-header>
<terminal-command command="vacuum lint -r my-ruleset.yaml -f ./my-functions my-openapi-spec.yaml" cliname=vacuum clicommand=lint flags=-r,-f></terminal-command></terminal-window><p>There should be message informing that vacuum has located a function plugin, and how many functions were loaded.</p><h3 id=example-output>Example output</h3><p>When the rule runs, if there is more than a single path in the OpenAPI document, then the function will return a message.</p><p>For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>More than a single path exists, there are 23
</span></span></code></pre></div><hr><h2 id=further-examples>Further Examples</h2><p>There are <a href=https://github.com/daveshanley/vacuum/tree/main/plugin/sample/js>example functions</a> available showcase
some of these features.</p></section></article></section><div class=right-nav><aside class=table-of-contents><p>What's on this page</p><nav id=TableOfContents><ul><li><a href=#structure-of-a-javascript-function>Structure of a JavaScript function</a><ul><li><a href=#the-input-argument>The input argument</a></li></ul></li><li><a href=#access-to-context>Access to context</a><ul><li><a href=#example-function-that-uses-context>Example function that uses context</a></li><li><a href=#context-type>Context type</a></li><li><a href=#specinfo-type>SpecInfo type</a></li><li><a href=#ruleaction-type>RuleAction type</a></li><li><a href=#rule-type>Rule type</a></li><li><a href=#rulecategory-type>RuleCategory type</a></li></ul></li><li><a href=#access-to-the-function-options>Access to the function options</a><ul><li><a href=#example-rule-and-function>Example rule and function</a></li></ul></li><li><a href=#providing-a-schema>Providing a schema</a></li><li><a href=#calling-core-functions>Calling core functions</a></li><li><a href=#tutorial>Tutorial</a><ul><li><a href=#setting-things-up>Setting things up</a></li><li><a href=#implement-the-logic>Implement the logic</a></li><li><a href=#configuring-functions>Configuring functions</a></li><li><a href=#example-ruleset>Example RuleSet</a></li><li><a href=#run-vacuum-with--f>Run vacuum with &lsquo;-f&rsquo;</a></li><li><a href=#example-output>Example output</a></li></ul></li><li><a href=#further-examples>Further Examples</a></li></ul></nav></aside></div></main></div><footer class=footer><a href=https://quobix.com/author>quobix</a> &copy;2007-2023
<span class=generated-timestamp>[generated 10/05/23 15:24 UTC]</span></footer></div></body></html>